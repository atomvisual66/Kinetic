<!DOCTYPE html>
<html lang="fr" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="theme-color" content="#020617">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="icon.png">

    <title>KINETIC | ULTIMATE</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.13.3/dist/cdn.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        dark: '#020617', // Slate 950
                        neon: { 
                            blue: '#3b82f6', 
                            cyan: '#06b6d4',
                            purple: '#8b5cf6',
                            emerald: '#10b981'
                        }
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        tech: ['Chakra Petch', 'monospace'],
                        logo: ['Russo One', 'sans-serif']
                    },
                    animation: {
                        'pulse-slow': 'pulse 4s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'shimmer': 'shimmer 2.5s infinite',
                        'float': 'float 6s ease-in-out infinite',
                    },
                    keyframes: {
                        shimmer: {
                            '100%': { transform: 'translateX(100%)' }
                        },
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-10px)' },
                        }
                    }
                }
            }
        }
    </script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Russo+One&family=Chakra+Petch:ital,wght@0,300;0,400;0,500;0,600;0,700;1,700&family=Inter:wght@300;400;600;800&display=swap');
        
        body { 
            background-color: #020617; 
            color: #e2e8f0; 
            -webkit-tap-highlight-color: transparent; 
            user-select: none; 
            overflow: hidden; 
        }
        
        /* SCROLLBAR */
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        /* UTILS */
        .pt-safe { padding-top: env(safe-area-inset-top); }
        .pb-safe { padding-bottom: env(safe-area-inset-bottom); }
        [x-cloak] { display: none !important; }

        /* --- STYLES AVANCÉS --- */
        .bg-noise {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none;
            z-index: -1;
            opacity: 0.03;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E");
        }

        .glass-card {
            background: rgba(13, 18, 30, 0.6);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: 
                0 4px 30px rgba(0, 0, 0, 0.3),
                inset 0 0 20px rgba(255, 255, 255, 0.02);
        }
        
        .nav-glass {
            background: rgba(2, 6, 23, 0.85);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 10px 40px -10px rgba(0,0,0,0.8);
        }

        .text-metal {
            background: linear-gradient(180deg, #ffffff 0%, #94a3b8 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            filter: drop-shadow(0 0 15px rgba(59, 130, 246, 0.4));
        }

        .btn-shine {
            position: relative;
            overflow: hidden;
        }
        .btn-shine::after {
            content: '';
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(to right, transparent 0%, rgba(255,255,255,0.2) 50%, transparent 100%);
            transform: translateX(-100%) skewX(-15deg);
            animation: shimmer 3s infinite;
        }

        .modal-enter { transition: opacity 0.3s cubic-bezier(0.16, 1, 0.3, 1), transform 0.3s cubic-bezier(0.16, 1, 0.3, 1); }
        .modal-enter-start { opacity: 0; transform: scale(0.95) translateY(20px); }
        .modal-enter-end { opacity: 1; transform: scale(1) translateY(0); }
    </style>
</head>

<body x-data="app()" x-init="init()" class="h-[100dvh] flex flex-col relative overflow-hidden">

    <div class="bg-noise"></div>

    <div class="fixed inset-0 z-0 pointer-events-none overflow-hidden">
        <div class="absolute top-[-20%] left-[-10%] w-[600px] h-[600px] bg-blue-600/10 rounded-full blur-[120px] animate-pulse-slow"></div>
        <div class="absolute bottom-[-10%] right-[-20%] w-[500px] h-[500px] bg-purple-600/10 rounded-full blur-[100px]"></div>
    </div>

    <header class="fixed top-0 left-0 right-0 z-50 pt-safe transition-all duration-300">
        <div class="absolute inset-0 bg-gradient-to-b from-[#020617] via-[#020617]/90 to-transparent h-28 backdrop-blur-[2px] pointer-events-none"></div>
        
        <div class="relative px-6 py-4 flex items-center justify-between">
            <div class="flex flex-col justify-center w-20">
                 <div class="flex items-center gap-1.5 opacity-80">
                    <div class="w-1 h-1 rounded-full bg-blue-400 shadow-[0_0_8px_rgba(59,130,246,0.8)]"></div>
                    <span class="text-[8px] font-bold text-blue-300 font-tech uppercase tracking-[0.2em]">Rang</span>
                 </div>
                 <span class="text-xs text-white font-bold tracking-wider font-tech mt-0.5" x-text="user.rank">NOVICE</span>
            </div>

            <div class="absolute left-1/2 -translate-x-1/2 text-center group cursor-pointer" @click="toggleSecret()">
                <h1 class="text-4xl font-logo italic tracking-tighter text-metal skew-x-[-6deg] group-hover:scale-105 transition-transform duration-300">
                    KINETIC
                </h1>
                <div class="h-0.5 w-12 bg-gradient-to-r from-transparent via-blue-500 to-transparent mx-auto mt-1 opacity-50"></div>
            </div>

            <div class="flex flex-col items-end justify-center w-20">
                <div class="flex items-center gap-1 mb-1.5">
                    <span class="text-[9px] text-slate-400 font-bold font-tech uppercase tracking-widest">S<span x-text="currentWeek"></span></span>
                    <span class="text-[9px] text-blue-400 font-bold font-tech uppercase">XP</span>
                </div>
                <div class="w-16 h-1 bg-slate-800/50 rounded-full overflow-hidden border border-white/5 relative">
                    <div class="absolute inset-0 bg-blue-500/20 blur-[2px]"></div>
                    <div class="h-full bg-gradient-to-r from-blue-600 to-cyan-400 shadow-[0_0_10px_rgba(6,182,212,0.5)]" :style="`width: ${xpPercent}%`"></div>
                </div>
            </div>
        </div>
    </header>

    <main class="flex-1 overflow-y-auto hide-scrollbar p-5 pt-32 pb-36 z-10 space-y-10">

        <div x-show="tab === 'home'" x-transition.opacity class="space-y-8">
            
            <div class="glass-card rounded-[32px] p-1 relative overflow-hidden group shadow-2xl animate-float">
                <div class="bg-[#0f172a]/40 rounded-[28px] p-6 relative overflow-hidden h-full">
                    
                    <div class="absolute left-0 top-8 bottom-8 w-1 rounded-r-full transition-colors duration-500" 
                         :class="isDone(todaySession.id) ? 'bg-emerald-500 shadow-[0_0_15px_rgba(16,185,129,0.6)]' : 'bg-blue-600 shadow-[0_0_15px_rgba(37,99,235,0.6)]'"></div>

                    <div class="absolute -right-6 -top-6 text-white opacity-[0.03] group-hover:opacity-[0.07] transition duration-700 transform rotate-12 group-hover:rotate-0 scale-150">
                        <i data-lucide="activity" class="w-48 h-48"></i>
                    </div>

                    <div class="relative z-10">
                        <div class="flex justify-between items-start mb-6 pl-4">
                            <span class="inline-block px-2 py-1 rounded bg-white/5 border border-white/5 text-[9px] font-bold text-blue-200 font-tech uppercase tracking-[0.2em] backdrop-blur-sm" x-text="todaySession.phase">PHASE</span>
                            <div class="text-right">
                                <span class="block text-[10px] font-bold text-slate-400 uppercase tracking-[0.2em] font-tech" x-text="todaySession.day">LUNDI</span>
                            </div>
                        </div>

                        <div class="pl-4 mb-6">
                            <h2 class="text-4xl font-logo text-white leading-none uppercase italic tracking-wide drop-shadow-xl" x-text="todaySession.type">SESSION</h2>
                            <div class="h-1 w-20 bg-gradient-to-r from-blue-500 to-transparent mt-2 rounded-full"></div>
                            <p class="text-xs text-slate-400 mt-4 leading-relaxed font-medium max-w-[90%]" x-text="todaySession.why"></p>
                        </div>

                        <div class="grid grid-cols-4 gap-2 mb-8">
                            <div class="bg-slate-900/60 p-2.5 rounded-2xl border border-white/5 text-center relative group/item">
                                <div class="absolute inset-0 bg-blue-500/5 rounded-2xl opacity-0 group-hover/item:opacity-100 transition"></div>
                                <div class="text-[8px] text-slate-500 uppercase font-bold tracking-wider mb-1">Vitesse</div>
                                <div class="text-lg font-bold text-white font-tech tracking-tighter" x-text="todaySession.speed"></div>
                                <div class="text-[8px] text-blue-400/60 font-tech">KM/H</div>
                            </div>
                            <div class="bg-slate-900/60 p-2.5 rounded-2xl border border-white/5 text-center relative group/item">
                                <div class="absolute inset-0 bg-white/5 rounded-2xl opacity-0 group-hover/item:opacity-100 transition"></div>
                                <div class="text-[8px] text-slate-500 uppercase font-bold tracking-wider mb-1">Durée</div>
                                <div class="text-lg font-bold text-white font-tech tracking-tighter" x-text="todaySession.duration"></div>
                                <div class="text-[8px] text-slate-400/60 font-tech">MIN</div>
                            </div>
                            <div class="bg-slate-900/60 p-2.5 rounded-2xl border border-white/5 text-center relative group/item">
                                <div class="absolute inset-0 bg-purple-500/5 rounded-2xl opacity-0 group-hover/item:opacity-100 transition"></div>
                                <div class="text-[8px] text-slate-500 uppercase font-bold tracking-wider mb-1">Pente</div>
                                <div class="text-lg font-bold text-blue-400 font-tech tracking-tighter" x-text="todaySession.incline + '%'"></div>
                                <div class="text-[8px] text-blue-400/60 font-tech">INCL</div>
                            </div>
                            <div class="bg-slate-900/60 p-2.5 rounded-2xl border border-white/5 text-center relative overflow-hidden">
                                <div class="absolute inset-0 bg-orange-500/10"></div>
                                <div class="text-[8px] text-orange-400/80 uppercase font-bold tracking-wider mb-1">Burn</div>
                                <div class="text-lg font-bold text-orange-400 font-tech tracking-tighter" x-text="calculateCalories(todaySession)"></div>
                                <div class="text-[8px] text-orange-400/60 font-tech">KCAL</div>
                            </div>
                        </div>

                        <div class="flex items-center justify-between bg-white/5 rounded-2xl p-3 border border-white/5 mb-8 backdrop-blur-sm">
                            <div class="flex items-center gap-3">
                                <div class="w-8 h-8 rounded-full bg-red-500/10 flex items-center justify-center text-red-500 border border-red-500/20 shadow-[0_0_15px_rgba(239,68,68,0.15)]">
                                    <i data-lucide="heart" class="w-4 h-4 fill-current animate-pulse"></i>
                                </div>
                                <div>
                                    <div class="text-[8px] text-slate-400 uppercase font-bold tracking-widest">Zone Cible</div>
                                    <div class="text-xs font-bold text-white font-tech tracking-wide" x-text="todaySession.zone + ' (' + getHeartRateTarget(todaySession.zone) + ' BPM)'"></div>
                                </div>
                            </div>
                        </div>

                        <button @click="toggleSession(todaySession.id)" 
                            class="w-full py-5 rounded-2xl font-logo text-sm uppercase tracking-[0.2em] transition-all active:scale-[0.98] shadow-2xl flex items-center justify-center gap-3 btn-shine group border"
                            :class="isDone(todaySession.id) 
                                ? 'bg-emerald-900/50 border-emerald-500/50 text-emerald-400 shadow-emerald-900/20' 
                                : 'bg-gradient-to-r from-blue-700 to-blue-600 border-blue-400/30 text-white shadow-blue-900/40 hover:shadow-blue-600/20'">
                            
                            <i :data-lucide="isDone(todaySession.id) ? 'check-circle-2' : 'play'" class="w-5 h-5 relative z-10 transition-transform group-hover:scale-110"></i>
                            <span class="relative z-10" x-text="isDone(todaySession.id) ? 'Séance Validée' : 'Initialiser'"></span>
                        </button>
                    </div>
                </div>
            </div>

            <div class="glass-card p-6 rounded-[28px] relative overflow-hidden group">
                <div class="absolute top-0 right-0 w-32 h-32 bg-purple-600/10 rounded-full blur-[50px] -mr-10 -mt-10"></div>
                
                <div class="flex items-center gap-3 mb-4 relative z-10">
                    <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-purple-500/20 to-blue-500/5 border border-purple-500/20 flex items-center justify-center text-purple-400 shadow-[0_0_15px_rgba(168,85,247,0.15)]">
                        <i data-lucide="dna" class="w-5 h-5"></i>
                    </div>
                    <div>
                        <div class="text-[9px] font-bold text-purple-400/60 uppercase tracking-[0.15em] font-tech">Bio-Feedback</div>
                        <h3 class="font-bold text-white text-base font-logo tracking-wide">Mécanisme Interne</h3>
                    </div>
                </div>
                
                <div class="pl-1 border-l-2 border-purple-500/20 ml-2">
                    <p class="text-sm text-slate-200 font-bold mb-2 pl-4" x-text="todaySession.bio.title"></p>
                    <p class="text-xs text-slate-400 leading-relaxed text-justify pl-4 font-medium" x-text="todaySession.bio.text"></p>
                </div>
            </div>
            
            <div class="h-8"></div>
        </div>

        <div x-show="tab === 'plan'" x-cloak x-transition.opacity class="space-y-6">
            
            <div class="glass-card p-6 rounded-[32px] relative overflow-hidden">
                <div class="absolute top-0 right-0 p-4 opacity-10 rotate-12 text-white">
                    <i data-lucide="layers" class="w-32 h-32"></i>
                </div>
                <div class="relative z-10">
                    <span class="inline-block px-2 py-0.5 rounded bg-blue-500/10 border border-blue-500/20 text-[9px] font-bold text-blue-300 font-tech uppercase tracking-[0.2em] mb-3">Mission du mois</span>
                    <h2 class="text-3xl font-logo text-white mb-3 italic tracking-wide" x-text="getPhaseInfo(viewWeek).title">PHASE</h2>
                    <p class="text-xs text-slate-300 leading-relaxed max-w-[85%] font-medium" x-text="getPhaseInfo(viewWeek).desc"></p>
                </div>
            </div>

            <div class="flex justify-between items-center px-2 py-1">
                <h2 class="text-lg font-logo text-white tracking-widest uppercase">Planning <span class="text-blue-500">S<span x-text="viewWeek"></span></span></h2>
                <div class="flex gap-2">
                    <button @click="changeWeek(-1)" class="w-10 h-10 flex items-center justify-center bg-slate-900 border border-white/10 rounded-xl text-slate-400 hover:text-white hover:border-blue-500/50 transition"><i data-lucide="chevron-left" class="w-5 h-5"></i></button>
                    <button @click="changeWeek(1)" class="w-10 h-10 flex items-center justify-center bg-slate-900 border border-white/10 rounded-xl text-slate-400 hover:text-white hover:border-blue-500/50 transition"><i data-lucide="chevron-right" class="w-5 h-5"></i></button>
                </div>
            </div>

            <div class="space-y-3">
                <template x-for="s in getWeekSessions(viewWeek)" :key="s.id">
                    <div @click="toggleSession(s.id)" class="glass-card p-4 rounded-2xl relative overflow-hidden group cursor-pointer transition-all active:scale-[0.98]" 
                         :class="isDone(s.id) ? 'border-emerald-500/40 bg-emerald-900/10' : 'hover:border-blue-500/30'">
                        
                        <div class="flex justify-between items-center relative z-10">
                            <div class="flex items-center gap-4">
                                <div class="w-12 h-12 rounded-xl flex items-center justify-center font-bold text-[10px] uppercase font-tech border shadow-lg transition-colors" 
                                     :class="isDone(s.id) ? 'bg-emerald-500 text-white border-emerald-400' : 'bg-slate-900 text-slate-500 border-white/10'">
                                    <span x-text="s.day.substring(0,3)"></span>
                                </div>
                                
                                <div>
                                    <h3 class="text-sm font-bold text-white group-hover:text-blue-300 transition font-logo uppercase tracking-wide" x-text="s.type"></h3>
                                    <div class="text-[9px] text-slate-500 font-tech uppercase tracking-wider flex gap-3 mt-1">
                                        <span class="flex items-center gap-1"><i data-lucide="clock" class="w-3 h-3"></i> <span x-text="s.duration + ' min'"></span></span>
                                        <span class="flex items-center gap-1"><i data-lucide="zap" class="w-3 h-3"></i> <span x-text="s.speed + ' km/h'"></span></span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="w-3 h-3 rounded-full shadow-[0_0_10px_currentColor] border border-white/20" :class="getZoneColor(s.zone)"></div>
                        </div>
                    </div>
                </template>
            </div>
        </div>

        <div x-show="tab === 'science'" x-cloak x-transition.opacity class="space-y-6">
            <div class="flex flex-col gap-1 mb-6 px-1">
                <h2 class="text-3xl font-logo text-white italic tracking-wide">Bibliothèque</h2>
                <p class="text-xs text-slate-400 font-tech uppercase tracking-widest">Base de données physiologique</p>
            </div>

            <div class="grid gap-4">
                <template x-for="item in scienceDb" :key="item.title">
                    <div @click="openScience(item)" class="glass-card p-5 rounded-3xl relative overflow-hidden group hover:border-blue-500/40 transition duration-300 cursor-pointer active:scale-[0.98]">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center gap-5">
                                <div class="w-14 h-14 rounded-2xl bg-[#0f172a] border border-white/10 flex items-center justify-center text-blue-400 group-hover:text-white group-hover:bg-blue-600 transition-all duration-300 shadow-xl group-hover:shadow-blue-500/20" x-html="item.icon"></div>
                                
                                <div>
                                    <div class="text-[9px] font-bold text-slate-500 uppercase tracking-[0.15em] mb-1.5 font-tech" x-text="item.category"></div>
                                    <h3 class="font-bold text-white text-sm leading-tight group-hover:text-blue-200 transition font-logo tracking-wide" x-text="item.title"></h3>
                                </div>
                            </div>

                            <div class="w-8 h-8 rounded-full bg-white/5 flex items-center justify-center group-hover:bg-blue-500 group-hover:text-white transition"><i data-lucide="chevron-right" class="w-4 h-4"></i></div>
                        </div>
                        
                        <div class="mt-5 pt-3 border-t border-white/5 flex items-center gap-2">
                             <div class="p-1 rounded bg-emerald-500/10 text-emerald-400"><i data-lucide="zap" class="w-3 h-3"></i></div>
                             <span class="text-[9px] font-bold text-emerald-400 uppercase tracking-wider font-tech" x-text="item.impact"></span>
                        </div>
                    </div>
                </template>
            </div>
            <div class="h-8"></div>
        </div>

        <div x-show="tab === 'settings'" x-cloak x-transition.opacity class="space-y-6">
            <h2 class="text-3xl font-logo text-white italic">Métabolisme</h2>
            
            <div class="glass-card p-8 rounded-[32px] text-center">
                <label class="block text-[10px] font-bold text-slate-500 uppercase mb-6 tracking-[0.3em] font-tech">Poids Actuel (kg)</label>
                
                <div class="flex items-center justify-center gap-8 mb-6">
                    <button @click="updateWeight(-0.5)" class="w-14 h-14 rounded-2xl bg-slate-900 border border-white/10 text-white flex items-center justify-center hover:bg-slate-800 transition active:scale-90 shadow-lg"><i data-lucide="minus" class="w-6 h-6"></i></button>
                    
                    <div class="relative">
                        <span class="text-6xl font-logo text-white tracking-tighter drop-shadow-[0_0_15px_rgba(255,255,255,0.3)]" x-text="user.weight"></span>
                        <div class="absolute -bottom-2 w-full h-1 bg-gradient-to-r from-transparent via-blue-500 to-transparent opacity-50"></div>
                    </div>
                    
                    <button @click="updateWeight(0.5)" class="w-14 h-14 rounded-2xl bg-slate-900 border border-white/10 text-white flex items-center justify-center hover:bg-slate-800 transition active:scale-90 shadow-lg"><i data-lucide="plus" class="w-6 h-6"></i></button>
                </div>
            </div>

            <button @click="resetData()" class="w-full py-5 text-red-400/60 text-xs border border-red-900/20 rounded-2xl bg-red-900/5 font-bold uppercase hover:bg-red-900/20 tracking-[0.2em] transition hover:border-red-500/30">
                Réinitialisation Usine
            </button>
        </div>

    </main>

    <nav class="fixed bottom-8 left-1/2 -translate-x-1/2 z-40 w-auto max-w-sm">
        <div class="nav-glass rounded-full p-2 flex items-center gap-2">
            <button @click="tab = 'home'" class="nav-btn group" :class="tab === 'home' ? 'active' : ''">
                <div class="icon-container"><i data-lucide="layout-dashboard" class="w-5 h-5 group-hover:scale-110 transition"></i></div>
            </button>
            <button @click="tab = 'plan'" class="nav-btn group" :class="tab === 'plan' ? 'active' : ''">
                <div class="icon-container"><i data-lucide="calendar" class="w-5 h-5 group-hover:scale-110 transition"></i></div>
            </button>
            <button @click="tab = 'science'" class="nav-btn group" :class="tab === 'science' ? 'active' : ''">
                <div class="icon-container"><i data-lucide="brain-circuit" class="w-5 h-5 group-hover:scale-110 transition"></i></div>
            </button>
            <button @click="tab = 'settings'" class="nav-btn group" :class="tab === 'settings' ? 'active' : ''">
                <div class="icon-container"><i data-lucide="user-cog" class="w-5 h-5 group-hover:scale-110 transition"></i></div>
            </button>
        </div>
    </nav>

    <style>
        .nav-btn { width: 50px; height: 50px; display: flex; align-items: center; justify-content: center; border-radius: 50%; color: #64748b; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
        .nav-btn.active { color: white; }
        .nav-btn.active .icon-container { 
            background: linear-gradient(135deg, #3b82f6, #2563eb); 
            box-shadow: 0 0 20px rgba(59,130,246,0.6); 
            transform: scale(1.1); 
            border: 1px solid rgba(255,255,255,0.2);
        }
        .icon-container { width: 42px; height: 42px; border-radius: 50%; display: flex; align-items: center; justify-content: center; transition: all 0.3s; }
    </style>

    <div x-show="activeScienceItem" class="fixed inset-0 z-[60] flex items-center justify-center p-4 bg-black/90 backdrop-blur-md" x-transition:enter="modal-enter" x-transition:enter-start="modal-enter-start" x-transition:enter-end="modal-enter-end" x-cloak>
        
        <div class="glass-card w-full max-w-sm rounded-[40px] p-0 relative shadow-2xl overflow-hidden flex flex-col max-h-[85vh]">
            
            <div class="bg-gradient-to-br from-slate-900 to-black p-8 pb-10 flex flex-col items-center justify-center relative border-b border-white/5">
                <button @click="activeScienceItem = null" class="absolute top-5 right-5 p-2 bg-white/5 rounded-full text-white/50 hover:text-white z-20 hover:bg-white/10 transition"><i data-lucide="x" class="w-5 h-5"></i></button>
                
                <div class="w-24 h-24 rounded-3xl bg-[#0f172a] border border-white/10 flex items-center justify-center text-blue-400 mb-6 shadow-[0_0_50px_rgba(59,130,246,0.2)]">
                    <div class="scale-[1.8]" x-html="activeScienceItem?.icon"></div>
                </div>
                
                <div class="text-[10px] font-bold text-blue-500 uppercase tracking-[0.3em] mb-2 font-tech" x-text="activeScienceItem?.category"></div>
                <h3 class="text-2xl font-logo text-white leading-tight italic text-center px-4" x-text="activeScienceItem?.title"></h3>
            </div>

            <div class="overflow-y-auto p-6 space-y-6 custom-scrollbar bg-[#020617]/50">
                
                <div>
                    <h4 class="text-[10px] font-bold text-slate-500 uppercase mb-3 tracking-widest font-tech">Analyse</h4>
                    <p class="text-sm text-slate-200 leading-relaxed text-justify font-medium opacity-90" x-text="activeScienceItem?.text"></p>
                </div>

                <div class="bg-black/40 rounded-3xl p-5 border border-white/5 relative">
                    <div class="absolute left-[29px] top-6 bottom-6 w-0.5 bg-gradient-to-b from-red-500/30 via-slate-700 to-emerald-500/30"></div>

                    <div class="flex gap-5 mb-6 relative z-10">
                        <div class="w-7 h-7 rounded-full bg-red-500/10 border border-red-500/30 flex items-center justify-center shrink-0 shadow-[0_0_10px_rgba(239,68,68,0.2)]">
                            <div class="w-2 h-2 bg-red-500 rounded-full"></div>
                        </div>
                        <div>
                            <div class="text-[9px] font-bold text-red-400/80 uppercase tracking-wide mb-1 font-tech">Avant</div>
                            <div class="text-xs text-slate-400 font-medium leading-snug" x-text="activeScienceItem?.before"></div>
                        </div>
                    </div>

                    <div class="flex gap-5 relative z-10">
                        <div class="w-7 h-7 rounded-full bg-emerald-500/10 border border-emerald-500/30 flex items-center justify-center shrink-0 shadow-[0_0_10px_rgba(16,185,129,0.2)]">
                            <i data-lucide="arrow-up" class="w-3.5 h-3.5 text-emerald-400"></i>
                        </div>
                        <div>
                            <div class="text-[9px] font-bold text-emerald-400/80 uppercase tracking-wide mb-1 font-tech">Après</div>
                            <div class="text-xs text-white font-bold leading-snug" x-text="activeScienceItem?.after"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        function app() {
            return {
                tab: 'home',
                user: { weight: 105, age: 30, xp: 0, rank: 'Novice' },
                currentWeek: 1,
                viewWeek: 1,
                completed: [],
                program: [],
                todaySession: {},
                activeScienceItem: null,
                
                // DATA ENRICHIE ET ÉTENDUE
                scienceDb: [
                    {
                        title: "Angiogenèse",
                        category: "Physiologie",
                        icon: `<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"></path></svg>`,
                        text: "L'angiogenèse est le processus de création de nouveaux vaisseaux sanguins à partir de ceux existants. Lorsque vous marchez régulièrement en Zone 2, vos muscles réclament plus d'oxygène de manière constante. Pour répondre à cette demande sans stress, le corps développe un réseau de capillaires plus dense. C'est littéralement comme transformer une route de campagne en autoroute à 6 voies : le sang (et donc l'oxygène et les nutriments) arrive beaucoup plus vite et en plus grande quantité aux cellules.",
                        before: "Essoufflement rapide, sensation de jambes lourdes au moindre effort.",
                        after: "Endurance quasi-infinie, récupération immédiate entre les efforts, baisse de la tension artérielle.",
                        impact: "Moteur Hybride V12"
                    },
                    {
                        title: "Disques Vertébraux",
                        category: "Rachis",
                        icon: `<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 14l-7 7m0 0l-7-7m7 7V3"></path></svg>`,
                        text: "Vos disques intervertébraux sont uniques : ils sont avasculaires, c'est-à-dire qu'ils ne possèdent pas de vaisseaux sanguins pour les nourrir directement. Ils fonctionnent comme des éponges. Le seul moyen pour eux de recevoir des nutriments et d'évacuer les déchets métaboliques est le phénomène d'imbibition par compression/décompression. Chaque pas que vous faites crée cette alternance de pression, agissant comme une pompe mécanique vitale. La sédentarité, c'est la mort du disque par asphyxie.",
                        before: "Dos raide le matin, douleurs lombaires chroniques, peur du mouvement.",
                        after: "Dos souple, disques hydratés et épais, sensation de colonne 'blindée'.",
                        impact: "Armure Dos"
                    },
                    {
                        title: "Mitochondries",
                        category: "Cellules",
                        icon: `<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>`,
                        text: "Les mitochondries sont les centrales énergétiques de vos cellules. C'est là que le gras est oxydé (brûlé) pour être transformé en ATP (énergie). La marche en Zone 2 est le stimulus le plus puissant pour augmenter la densité mitochondriale. Contrairement au HIIT qui peut en détruire par excès de stress oxydatif si mal dosé, la marche en construit massivement. Plus vous avez de mitochondries, plus vous êtes capable de brûler du gras au repos, simplement en existant.",
                        before: "Fatigue chronique, métabolisme lent, stockage facile du gras.",
                        after: "Fournaise métabolique active 24h/24, énergie constante.",
                        impact: "Métabolisme Nucléaire"
                    },
                    {
                        title: "VO2 Max",
                        category: "Longevity",
                        icon: `<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path></svg>`,
                        text: "Le VO2 Max représente le volume maximal d'oxygène que votre corps peut consommer lors d'un effort intense. C'est la cylindrée de votre moteur. Plus il est élevé, plus vous êtes performant. Mais c'est surtout le marqueur biologique le plus corrélé à l'espérance de vie, loin devant le cholestérol ou la pression artérielle. Passer d'un VO2 Max 'Faible' à 'Moyen' réduit le risque de mortalité toutes causes confondues de près de 50%.",
                        before: "Cœur qui s'emballe vite, incapacité à soutenir un effort intense.",
                        after: "Cœur d'athlète, espérance de vie augmentée de 10 ans.",
                        impact: "Vie +10 Ans"
                    },
                    {
                        title: "BDNF (Cerveau)",
                        category: "Mental",
                        icon: `<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path></svg>`,
                        text: "Le Brain-Derived Neurotrophic Factor (BDNF) est une protéine miracle pour le cerveau. Elle agit comme un engrais pour vos neurones, favorisant la neurogenèse (création de nouveaux neurones) et la plasticité synaptique. La marche est l'un des moyens les plus efficaces pour déclencher sa production. Elle protège l'hippocampe (centre de la mémoire) contre l'atrophie liée au stress et à l'âge, et combat activement la dépression.",
                        before: "Brouillard mental, anxiété, humeur variable, oublis.",
                        after: "Focus laser, clarté mentale, moral d'acier, créativité.",
                        impact: "Nootropique Naturel"
                    },
                    {
                        title: "Retour Veineux",
                        category: "Circulation",
                        icon: `<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path></svg>`,
                        text: "Le sang descend facilement dans les jambes grâce à la gravité, mais remonter est un défi. Le cœur est trop loin pour aspirer efficacement ce sang. La nature a donc placé un 'deuxième cœur' dans vos mollets : les muscles gastrocnémiens et soléaires. À chaque pas, leur contraction compresse les veines profondes et propulse le sang vers le haut. Sans marche, le sang stagne, créant œdèmes, varices et mauvaise récupération.",
                        before: "Jambes lourdes, chevilles gonflées le soir, mauvaise récupération.",
                        after: "Jambes légères et sèches, circulation fluide.",
                        impact: "Drainage Automatique"
                    },
                    {
                        title: "Lipolyse",
                        category: "Fat Loss",
                        icon: `<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 18.657A8 8 0 016.343 7.343S7 9 9 10c0-2 .5-5 2.986-7C14 5 16.09 5.777 17.656 7.343A7.975 7.975 0 0120 13a7.975 7.975 0 01-2.343 5.657z"></path></svg>`,
                        text: "Il existe deux carburants principaux : le glucose (sucre, rapide mais limité) et les lipides (gras, lent mais infini). À haute intensité, le corps n'a pas le temps d'oxyder le gras et brûle du sucre (Glycolyse), ce qui donne faim après. À intensité modérée comme la marche (Zone 2), l'oxygène est abondant, permettant la Lipolyse : la dégradation directe des triglycérides stockés dans vos bourrelets. C'est le seul moyen de sécher sans affamer le corps.",
                        before: "Efforts intenses mais peu de perte de gras, fringales.",
                        after: "Machine à brûler du gras pur, satiété stable.",
                        impact: "Séchage Optimal"
                    },
                    {
                        title: "Loi de Wolff",
                        category: "Squelette",
                        icon: `<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path></svg>`,
                        text: "La Loi de Wolff est un principe fondamental en orthopédie : l'os est un tissu vivant qui s'adapte aux contraintes mécaniques qu'il subit. Si vous chargez un os (par la marche et la gravité), il se densifie en déposant plus de minéraux. Si vous ne le chargez pas (sédentarité), il s'atrophie (ostéoporose). La marche, surtout avec une légère pente ou un gilet lesté, envoie un signal puissant aux ostéoblastes pour renforcer votre charpente.",
                        before: "Fragilité osseuse, risque de fracture futur.",
                        after: "Os denses, structure squelettique indestructible.",
                        impact: "Solidité Totale"
                    }
                ],
                bioDb: { 'Marche Rapide': { title: "Vasodilatation", text: "Ouverture des capillaires, baisse de la tension artérielle." }, 'Marche Active': { title: "Fibres Type I", text: "Activation des fibres d'endurance pures mangeuses de gras." }, 'Volume': { title: "Capillarisation", text: "Création massive de réseau sanguin dans les jambes." }, 'Pente Douce': { title: "Chaîne Postérieure", text: "Réveil des fessiers et ischios sans choc." }, 'Challenge Pente': { title: "Gainage Actif", text: "Renforcement profond des muscles spinaux." }, 'Sortie Longue': { title: "Lipolyse Max", text: "Épuisement du glycogène, attaque des graisses tenaces." }, 'Pyramide': { title: "Variabilité", text: "Adaptation cardiaque et résilience nerveuse." }, 'Intervalles': { title: "VO2 Max Boost", text: "Pression maximale sur le système cardiovasculaire." }, 'Rando Tapis': { title: "Force Endurance", text: "Recyclage des lactates en énergie." }, 'Maintien': { title: "Récupération", text: "Flush des toxines sans stress cortisol." }, 'HIIT Marche': { title: "EPOC Effect", text: "Dette d'oxygène : tu brûles pendant 24h après." }, 'Volume Max': { title: "Mental", text: "Forge du mental et tolérance à l'effort long." }, 'Récup Active': { title: "Drainage", text: "Pompage lymphatique, jambes légères." }, 'Repos': { title: "Anabolisme", text: "Construction musculaire et oxydation." } },
                phasesDb: { 1: { title: "PHASE 1 : FONDATION", desc: "Créer l'habitude. Préparer les tendons. Baisser la FC Repos." }, 2: { title: "PHASE 2 : FORCE", desc: "Monter l'intensité via la pente. Construire le fessier et le dos." }, 3: { title: "PHASE 3 : BURN", desc: "Optimisation totale. HIIT et Volume pour sécher le gras." } },

                init() {
                    lucide.createIcons();
                    this.loadData();
                    this.generateProgram();
                    this.findToday();
                    this.$nextTick(() => lucide.createIcons());
                },

                // --- CORE LOGIC ---
                openScience(item) { this.activeScienceItem = item; },
                loadData() { const data = JSON.parse(localStorage.getItem('kinetic_v3')); if(data) { this.user = data.user || this.user; this.currentWeek = data.currentWeek || 1; this.completed = data.completed || []; } this.viewWeek = this.currentWeek; },
                save() { localStorage.setItem('kinetic_v3', JSON.stringify({ user: this.user, currentWeek: this.currentWeek, completed: this.completed })); },
                getPhaseInfo(week) { if (week <= 4) return this.phasesDb[1]; if (week <= 8) return this.phasesDb[2]; return this.phasesDb[3]; },
                calculateCalories(session) { let speed = parseFloat(session.speed.split('-')[0]) || 4; let incline = parseFloat(session.incline.split('-')[0]) || 0; let durationHours = parseInt(session.duration) / 60; let baseMets = 3.0; if (speed > 4) baseMets += (speed - 4); let inclineMets = incline * 0.6; let totalMets = baseMets + inclineMets; if(session.zone.includes('3') || session.zone.includes('4')) totalMets *= 1.1; return Math.round(totalMets * this.user.weight * durationHours) || 0; },
                getHeartRateTarget(zone) { let maxHR = 220 - this.user.age; if(zone.includes('1')) return Math.round(maxHR * 0.55) + '-' + Math.round(maxHR * 0.65); if(zone.includes('2')) return Math.round(maxHR * 0.65) + '-' + Math.round(maxHR * 0.75); if(zone.includes('3')) return Math.round(maxHR * 0.75) + '-' + Math.round(maxHR * 0.85); if(zone.includes('4')) return Math.round(maxHR * 0.85) + '+'; return "N/A"; },
                updateWeight(delta) { this.user.weight = Math.round((this.user.weight + delta) * 10) / 10; this.save(); },
                toggleSecret() { confetti({ particleCount: 150, spread: 70, origin: { y: 0.1 }, colors: ['#ffffff', '#3b82f6'] }); },
                getZoneColor(z) { if(z.includes('2')) return 'bg-emerald-500 text-emerald-400'; if(z.includes('3')) return 'bg-orange-500 text-orange-400'; if(z.includes('4')) return 'bg-red-500 text-red-400'; return 'bg-blue-500 text-blue-400'; },
                resetData() { if(confirm("RESET TOTAL ?")) { localStorage.removeItem('kinetic_v3'); location.reload(); } },
                isDone(id) { return this.completed.includes(id); },
                get xpPercent() { return (this.user.xp % 1000) / 10; },
                getWeekSessions(w) { return this.program.filter(s => s.week === w); },
                changeWeek(d) { let n = this.viewWeek + d; if(n >= 1 && n <= 12) this.viewWeek = n; },
                findToday() { const days = ['Dimanche', 'Lundi', 'Mardi', 'Mercredi', 'Jeudi', 'Vendredi', 'Samedi']; const todayName = days[new Date().getDay()]; this.todaySession = this.program.find(s => s.week === this.currentWeek && s.day === todayName) || this.program[0]; },
                toggleSession(id) { if (this.completed.includes(id)) { this.completed = this.completed.filter(x => x !== id); this.user.xp -= 100; } else { this.completed.push(id); this.user.xp += 100; confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 }, colors: ['#3b82f6', '#10b981'] }); if (id.includes('Dimanche') && this.currentWeek < 12) { setTimeout(() => { if(confirm("Semaine terminée ! Passer à la suivante ?")) { this.currentWeek++; this.viewWeek++; this.findToday(); this.save(); } }, 500); } } this.save(); },

                generateProgram() {
                    const days = ['Lundi', 'Mardi', 'Mercredi', 'Jeudi', 'Vendredi', 'Samedi', 'Dimanche'];
                    let list = [];
                    for (let w = 1; w <= 12; w++) {
                        let phase = w <= 4 ? "Phase 1: Fondation" : (w <= 8 ? "Phase 2: Force" : "Phase 3: Burn");
                        days.forEach(day => {
                            let s = { id: `w${w}-${day}`, week: w, day: day, phase: phase, type: 'Repos', speed: '0', incline: '0', duration: '0', zone: 'Zone 1', why: 'Récupération' };
                            if (w <= 4) { if (day === 'Lundi') { s.type = "Marche Rapide"; s.speed = "4.5-5"; s.incline = "1"; s.duration = "30"; s.zone = "Zone 2"; s.why = "Active la circulation."; } else if (day === 'Mardi') { s.type = "Marche Active"; s.speed = "4.0-4.5"; s.incline = "2"; s.duration = "35"; s.zone = "Zone 2"; s.why = "Engagement fessiers."; } else if (day === 'Jeudi') { s.type = "Volume"; s.speed = "4.5-5"; s.incline = "1"; s.duration = "40"; s.zone = "Zone 2"; s.why = "Endurance fondamentale."; } else if (day === 'Vendredi') { s.type = "Pente Douce"; s.speed = "3.5-4"; s.incline = "4"; s.duration = "25"; s.zone = "Haut Z2"; s.why = "Renforcement dos."; s.safety = "Gaine les abdos !"; } else if (day === 'Samedi') { s.type = "Sortie Longue"; s.speed = "4.0-4.5"; s.incline = "0"; s.duration = "50"; s.zone = "Zone 2"; s.why = "Lipolyse max."; } else if (day === 'Mercredi') { s.type = "Récup Active"; s.speed = "3.5-4"; s.incline = "0"; s.duration = "30"; s.zone = "Zone 1"; s.why = "Récupération."; } } 
                            else if (w <= 8) { if (day === 'Lundi') { s.type = "Pyramide"; s.speed = "4.5"; s.incline = "2-6"; s.duration = "40"; s.zone = "Zone 3"; s.why = "Cardio varié."; } else if (day === 'Mercredi') { s.type = "Intervalles"; s.speed = "4.0"; s.incline = "8"; s.duration = "30"; s.zone = "Zone 3"; s.why = "Boost VO2Max."; s.safety = "Stop si mal au dos."; } else if (day === 'Samedi') { s.type = "Rando Tapis"; s.speed = "4.0"; s.incline = "5"; s.duration = "45"; s.zone = "Zone 2"; s.why = "Simul montagne."; } else if (day !== 'Dimanche') { s.type = "Maintien"; s.speed = "4.5"; s.incline = "1"; s.duration = "35"; s.zone = "Zone 2"; s.why = "Volume."; } } 
                            else { if (day === 'Lundi' || day === 'Jeudi') { s.type = "HIIT Marche"; s.speed = "4.0"; s.incline = "12"; s.duration = "35"; s.zone = "Zone 4"; s.why = "Afterburn max."; s.safety = "Ventre rentré !"; } else if (day === 'Samedi') { s.type = "Volume Max"; s.speed = "4.5"; s.incline = "2"; s.duration = "60"; s.zone = "Zone 2"; s.why = "Endurance fer."; } else if (day !== 'Dimanche') { s.type = "Récup Active"; s.speed = "4.0"; s.incline = "0"; s.duration = "40"; s.zone = "Zone 1"; s.why = "Cool down."; } }
                            s.bio = this.bioDb[s.type] || this.bioDb['Repos'];
                            list.push(s);
                        });
                    }
                    this.program = list;
                }
            }
        }
    </script>
</body>
</html>